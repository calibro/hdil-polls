"use strict";angular.module("hdilPollsApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","angular-loading-bar","rzModule","ui.checkbox","vs-repeat"]).config(["$routeProvider",function(a){a.when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",controllerAs:"home"}).when("/explore",{templateUrl:"views/explore.html",controller:"ExploreCtrl",controllerAs:"explore"}).otherwise({redirectTo:"/home"})}]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]),angular.module("hdilPollsApp").controller("HomeCtrl",["$scope",function(a){a.title="Human data interaction<br>in Lombardia",a.description="Lorem ipsum dolor sit amet, vim laudem accommodare te. Mea an constituto honestatis referrentur, eros philosophia vim ei. Qui in esse oportere, etiam postea quaestio te eos. Quo ut cibo ludus iracundia, ea iudico maiorum invenire eum. Vocent voluptatum at vel, et modus ignota commune has, dico splendide ut mel. In eripuit recusabo eum."}]),angular.module("hdilPollsApp").controller("ExploreCtrl",["$scope","$sce","apiservice","cfservice",function(a,b,c,d){a.vizs,a.vizSelected,a.tabModel,a.data=[],a.matrix=[],a.changeViz=function(b){a.vizSelected=b,a.filterBarsResetAll(),d.id().filter(a.vizSelected.id),a.ages=d.ages().all(),a.devices=d.devices().all(),a.sexes=d.sexes().all();var c=Math.max(d3.max(a.ages,function(a){return a.value}),d3.max(a.devices,function(a){return a.value}),d3.max(a.sexes,function(a){return a.value}));a.agesScale=d3.scaleLinear().domain([0,c]).range([0,90]),a.devicesScale=d3.scaleLinear().domain([0,c]).range([0,90]),a.sexesScale=d3.scaleLinear().domain([0,c]).range([0,90]),a.data=[{key:"utilità",values:d.utilities().all(),maxY:d3.max(d.utilities().all(),function(a){return a.value})},{key:"intuitività",values:d.intuitivenesses().all(),maxY:d3.max(d.intuitivenesses().all(),function(a){return a.value})},{key:"chiarezza",values:d.clarities().all(),maxY:d3.max(d.clarities().all(),function(a){return a.value})},{key:"informatività",values:d.informativenesses().all(),maxY:d3.max(d.informativenesses().all(),function(a){return a.value})},{key:"bellezza",values:d.beauties().all(),maxY:d3.max(d.beauties().all(),function(a){return a.value})},{key:"valore complessivo",values:d.overalls().all(),maxY:d3.max(d.overalls().all(),function(a){return a.value})}];var g=d3.nest().key(function(b){return b[a.xAxis.key.toUpperCase()]+"_"+b[a.yAxis.key.toUpperCase()]}).rollup(function(a){return a.length}).entries(d.cf().allFiltered());a.matrix=g.map(function(a){var b=a.key.split("_")[0]?a.key.split("_")[0]:"0",c=a.key.split("_")[1]?a.key.split("_")[1]:"0";return{x:b,y:c,value:a.value}}),f(),e()},a.currentFilters={device:[],age:[],sex:[]},a.labelDict={device:{1:"PC",2:"Smartphone",3:"Tablet",4:"Altro"},age:{1:"meno di 21 anni",2:"tra 21 e 30 anni compiuti",3:"tra 31 e 45 anni compiuti",4:"tra 46 e 60 anni compiuti",5:"età superiore ai 60 anni"},sex:{1:"Donne",2:"Uomini"}},a.filterBars=function(b,c){if(a.currentFilters[b].indexOf(c)<0)a.currentFilters[b].push(c);else{var g=a.currentFilters[b].indexOf(c);a.currentFilters[b].splice(g,1)}a.currentFilters[b].length?d[b]().filter(function(c){return a.currentFilters[b].indexOf(c)>-1}):d[b]().filterAll();var h=d3.nest().key(function(b){return b[a.xAxis.key.toUpperCase()]+"_"+b[a.yAxis.key.toUpperCase()]}).rollup(function(a){return a.length}).entries(d.cf().allFiltered());a.matrix=h.map(function(a){var b=a.key.split("_")[0]?a.key.split("_")[0]:"0",c=a.key.split("_")[1]?a.key.split("_")[1]:"0";return{x:b,y:c,value:a.value}}),f(),e()},a.filterBarsReset=function(b){a.currentFilters[b]=[],d[b]().filterAll();var c=d3.nest().key(function(b){return b[a.xAxis.key.toUpperCase()]+"_"+b[a.yAxis.key.toUpperCase()]}).rollup(function(a){return a.length}).entries(d.cf().allFiltered());a.matrix=c.map(function(a){var b=a.key.split("_")[0]?a.key.split("_")[0]:"0",c=a.key.split("_")[1]?a.key.split("_")[1]:"0";return{x:b,y:c,value:a.value}}),f(),e()},a.filterBarsResetAll=function(b){Object.keys(a.currentFilters).forEach(function(b){a.currentFilters[b]=[],d[b]().filterAll()})},a.checkBarInactive=function(b,c){return a.currentFilters[b].length?-1==a.currentFilters[b].indexOf(c):!1},a.selectChange=function(){var b=d3.nest().key(function(b){return b[a.xAxis.key.toUpperCase()]+"_"+b[a.yAxis.key.toUpperCase()]}).rollup(function(a){return a.length}).entries(d.cf().allFiltered());a.matrix=b.map(function(a){var b=a.key.split("_")[0]?a.key.split("_")[0]:"0",c=a.key.split("_")[1]?a.key.split("_")[1]:"0";return{x:b,y:c,value:a.value}})},a.update=!0;var e=function(){a.update=!a.update};a.updateMatrix=!0;var f=function(){a.updateMatrix=!a.updateMatrix};a.$watch("tabModel",function(a,b){}),c.getSpreadsheetViz().then(function(e){a.vizs=d3.tsvParse(e).map(function(a){return a.url_embed=b.trustAsResourceUrl(a.url_embed),a}),a.vizSelected=a.vizs[0],a.tabModel="correlation",c.getSpreadsheetData().then(function(b){d.add(d3.tsvParse(b)),a.scaleMatrix=d3.range(7).map(function(a){return a.toString()}),d.id().filter(a.vizSelected.id),a.ages=d.ages().all(),a.devices=d.devices().all(),a.sexes=d.sexes().all();var c=Math.max(d3.max(a.ages,function(a){return a.value}),d3.max(a.devices,function(a){return a.value}),d3.max(a.sexes,function(a){return a.value}));a.agesScale=d3.scaleLinear().domain([0,c]).range([0,90]),a.devicesScale=d3.scaleLinear().domain([0,c]).range([0,90]),a.sexesScale=d3.scaleLinear().domain([0,c]).range([0,90]),a.data=[{key:"utilità",values:d.utilities().all(),maxY:d3.max(d.utilities().all(),function(a){return a.value})},{key:"intuitività",values:d.intuitivenesses().all(),maxY:d3.max(d.intuitivenesses().all(),function(a){return a.value})},{key:"chiarezza",values:d.clarities().all(),maxY:d3.max(d.clarities().all(),function(a){return a.value})},{key:"informatività",values:d.informativenesses().all(),maxY:d3.max(d.informativenesses().all(),function(a){return a.value})},{key:"bellezza",values:d.beauties().all(),maxY:d3.max(d.beauties().all(),function(a){return a.value})},{key:"valore complessivo",values:d.overalls().all(),maxY:d3.max(d.overalls().all(),function(a){return a.value})}],a.dropdown=[{key:"utilità"},{key:"intuitività"},{key:"chiarezza"},{key:"informatività"},{key:"bellezza"},{key:"valore complessivo"}],a.xAxis=a.dropdown[0],a.yAxis=a.dropdown[1];var e=d3.nest().key(function(b){return b[a.xAxis.key.toUpperCase()]+"_"+b[a.yAxis.key.toUpperCase()]}).rollup(function(a){return a.length}).entries(d.cf().allFiltered());a.matrix=e.map(function(a){var b=a.key.split("_")[0]?a.key.split("_")[0]:"0",c=a.key.split("_")[1]?a.key.split("_")[1]:"0";return{x:b,y:c,value:a.value}})},function(b){a.errors=b})},function(b){a.errors=b})}]),angular.module("hdilPollsApp").factory("cfservice",function(){var a=crossfilter([]),b=a.dimension(function(a){return a["ETÀ"]}),c=b.group().reduceCount(),d=a.dimension(function(a){return a.DISPOSITIVO}),e=d.group().reduceCount(),f=a.dimension(function(a){return a.GENERE}),g=f.group().reduceCount(),h=a.dimension(function(a){return a.ID}),i=h.group().reduceCount(),j=a.dimension(function(a){return a["UTILITÀ"]}),k=j.group().reduceCount(),l=a.dimension(function(a){return a["INTUITIVITÀ"]}),m=l.group().reduceCount(),n=a.dimension(function(a){return a.CHIAREZZA}),o=n.group().reduceCount(),p=a.dimension(function(a){return a["INFORMATIVITÀ"]}),q=p.group().reduceCount(),r=a.dimension(function(a){return a.BELLEZZA}),s=r.group().reduceCount(),t=a.dimension(function(a){return a["VALORE COMPLESSIVO"]}),u=t.group().reduceCount(),v={};return v.cf=function(){return a},v.add=function(b){a.add(b)},v.clear=function(){a.remove()},v.size=function(){return a.size()},v.age=function(){return b},v.ages=function(){return c},v.device=function(){return d},v.devices=function(){return e},v.sex=function(){return f},v.sexes=function(){return g},v.id=function(){return h},v.ids=function(){return i},v.utility=function(){return j},v.utilities=function(){return k},v.intuitiveness=function(){return l},v.intuitivenesses=function(){return m},v.clarity=function(){return n},v.clarities=function(){return o},v.informativeness=function(){return p},v.informativenesses=function(){return q},v.beauty=function(){return r},v.beauties=function(){return s},v.overall=function(){return t},v.overalls=function(){return u},v}),angular.module("hdilPollsApp").factory("apiservice",["$http","$q",function(a,b){var c="2PACX-1vScPN9yhHnab1Jdv-sRzW4mPG4_YtUivb7jGfS-T9JzdzA6kdUm7wbJ-fXT-COLBq_6ozPzgtQK0iao",d="https://docs.google.com/spreadsheets/d/e/"+c+"/pub";return{getSpreadsheetData:function(){var c={gid:"112972804",single:"true",output:"tsv"},e=d,f=b.defer();return a.get(e,{params:c}).then(function(a){f.resolve(a.data)},function(a){f.reject(a)}),f.promise},getSpreadsheetViz:function(){var c={gid:"7267316",single:"true",output:"tsv"},e=d,f=b.defer();return a.get(e,{params:c}).then(function(a){f.resolve(a.data)},function(a){f.reject(a)}),f.promise}}}]),angular.module("hdilPollsApp").directive("iframesrc",function(){return{restrict:"A",link:function(a,b,c){a.$watch("tabModel",function(c,d){"info"==c?b.attr("src",a.vizSelected.url_embed):b.attr("src","")}),a.$watch("vizSelected",function(c,d){c&&"info"==a.tabModel&&b.attr("src",c.url_embed)},!0)}}}),angular.module("hdilPollsApp").directive("violinplot",function(){return{replace:!1,restrict:"A",link:function(a,b,c){var d=d3.select(b[0]),e=b.width(),f=575,g=hdil.violin().width(e).height(f);d.datum(a.data).call(g),a.$watch("data.length",function(b,c){b!=c&&d.datum(a.data).call(g)}),a.$watch("update",function(b,c){b!=c&&d.datum(a.data).call(g)})}}}),angular.module("hdilPollsApp").directive("matrix",function(){return{replace:!1,restrict:"A",link:function(a,b,c){var d=d3.select(b[0]),e=b.width(),f=500,g=hdil.matrix().width(e).height(f).scale(a.scaleMatrix);d.datum(a.matrix).call(g),a.$watch("matrix.length",function(b,c){b!=c&&d.datum(a.matrix).call(g.scale(a.scaleMatrix))}),a.$watch("updateMatrix",function(b,c){b!=c&&d.datum(a.matrix).call(g.scale(a.scaleMatrix))})}}}),angular.module("hdilPollsApp").run(["$templateCache",function(a){a.put("views/explore.html",'<div class="container-fluid explore-container"> <div class="row thumbs-container"> <div class="col-md-12"> <div class="container"> <div class="row"> <div class="col-sm-12"> <h4>Seleziona l\'infografica</h4> </div> </div> <div class="row"> <div class="col-sm-2" ng-repeat="viz in vizs"> <div class="thumb-viz" ng-click="changeViz(viz)" ng-class="{\'thumb-viz-active\': viz.id == vizSelected.id }" ng-style="{\'background-image\':\'url(images/ignore/\' + viz.thumb + \')\'}"> </div> </div> </div> </div> </div> </div> </div> <div class="container-controller"> <div class="container"> <div class="row table-controller"> <div class="col-sm-12"> <div class="btn-group"> <label class="btn btn-primary" ng-model="tabModel" uib-btn-radio="\'info\'">Infografica</label> <label class="btn btn-primary" ng-model="tabModel" uib-btn-radio="\'distribution\'">Distribuzione delle risposte</label> <label class="btn btn-primary" ng-model="tabModel" uib-btn-radio="\'correlation\'">Correlazione fra le risposte</label> </div> </div> </div> </div> </div> <div id="info" class="container" ng-show="tabModel == \'info\'"> <div class="row"> <div class="col-sm-6"> <h5 class="tab-title">descrizione:</h5> <p> {{vizSelected.titolo}} </p> </div> </div> <div class="row"> <div class="col-sm-12"> <iframe iframesrc frameborder="0" src="" width="100%" height="700"></iframe> </div> </div> </div> <div id="vizs" class="container" ng-show="tabModel == \'distribution\' || tabModel == \'correlation\'"> <div class="row"> <div class="col-sm-9"> <div id="distribution" ng-show="tabModel == \'distribution\'"> <h5 class="tab-title">Distribuzioni risposte per dimensione di qualità</h5> <div violinplot></div> </div> <div id="correlation" ng-show="tabModel == \'correlation\'"> <h5 class="tab-title">Correlazioni tra dimensioni di qualità</h5> <div class="form-group col-sm-6"> <label class="axis-label">Asse X</label> <select class="form-control" ng-model="xAxis" ng-options="d.key for d in dropdown" ng-change="selectChange()"> </select> </div> <div class="form-group col-sm-6"> <label class="axis-label">Asse Y</label> <select class="form-control" ng-model="yAxis" ng-options="d.key for d in dropdown" ng-change="selectChange()"> </select> </div> <div matrix></div> </div> </div> <div class="col-sm-3"> <h5 class="tab-title">FILTRI</h5> <div class="filter-head"> <h5>età</h5> <div class="reset" ng-click="filterBarsReset(\'age\')"> reset </div> </div> <div ng-repeat="age in ages track by age.key"> <div class="row-label"> {{age.key? labelDict[\'age\'][age.key] :\'sconosciuto\'}} </div> <div class="bars-container"> <div class="bar" ng-class="{\'bar-inactive\': checkBarInactive(\'age\',age.key)}" ng-click="filterBars(\'age\',age.key)" ng-style="{\'width\': devicesScale(age.value) + \'%\'}"> </div> <div class="bar-value"> {{age.value}} </div> </div> </div> <div class="filter-head"> <h5>dispositivo</h5> <div class="reset" ng-click="filterBarsReset(\'device\')"> reset </div> </div> <div ng-repeat="device in devices track by device.key"> <div class="row-label"> {{device.key?labelDict[\'device\'][device.key]:\'sconosciuto\'}} </div> <div class="bars-container"> <div class="bar" ng-class="{\'bar-inactive\': checkBarInactive(\'device\',device.key)}" ng-click="filterBars(\'device\',device.key)" ng-style="{\'width\': devicesScale(device.value) + \'%\'}"> </div> <div class="bar-value"> {{device.value}} </div> </div> </div> <div class="filter-head"> <h5>genere</h5> <div class="reset" ng-click="filterBarsReset(\'sex\')"> reset </div> </div> <div ng-repeat="sex in sexes track by sex.key"> <div class="row-label"> {{sex.key?labelDict[\'sex\'][sex.key]:\'sconosciuto\'}} </div> <div class="bars-container"> <div class="bar" ng-class="{\'bar-inactive\': checkBarInactive(\'sex\',sex.key)}" ng-click="filterBars(\'sex\',sex.key)" ng-style="{\'width\': devicesScale(sex.value) + \'%\'}"> </div> <div class="bar-value"> {{sex.value}} </div> </div> </div> </div> </div> </div> <div class="alert-errors" ng-show="errors"> <h3>Oooops, si è verificato un errore:</h3> <button type="button" class="close" data-dismiss="alert" aria-label="Close" ng-click="errors = \'\'"><span aria-hidden="true">&times;</span></button> <pre>{{errors | json }}</pre> </div>'),a.put("views/home.html",'<div class="container-wrapper"> <div class="container home-container"> <div class="row"> <div class="col-md-8"> <h1 ng-bind-html="title"></h1> <p> {{description}} </p> <a href="#!/explore" class="btn btn-default btn-lg btn-explore"> esplora i dati </a> </div> </div> </div> </div>')}]);